---
layout: post
title: 多个SSH key的配置
---


应该很多大部分程序猿朋友都见过ssh，比如你在访问github之类的git代码管理工具的时候。

### 什么是SSH

SSH是Secure shell的缩写，即“安全外壳协议”，专为远程登录会话和其他网络服务提供安全性的协议，是一项计算机上的安全协议。

简单说，SSH是一种网络协议，用于计算机之间的加密登录。如果一个用户从本地计算机，使用SSH协议登录另一台远程计算机，我们就可以认为，这种登录是安全的，即使被中途截获，密码也不会泄露。

最早的时候，互联网通信都是明文通信，一旦被截获，内容就暴露无疑。1995年，芬兰学者Tatu Ylonen设计了SSH协议，将登录信息全部加密，成为互联网安全的一个基本解决方案，迅速在全世界获得推广，目前已经成为Linux系统的标准配置。

需要指出的是，SSH只是一种协议，存在多种实现，既有商业实现，也有开源实现。本文针对的实现是OpenSSH，它是自由软件，应用非常广泛。

### SSH的基本使用

最基本的用法比如远程登录。

假定您的用户名是xiaoming，登录远程主机baidu.com，那么一般是下面这条命令。

	ssh xiaoming@baidu.com
	
上述命令默认连接端口22，这也是ssh协议的默认端口；当然你可以指定连接的端口，比如：

    ssh -p 1212 xiaoming@baidu.com
	
### SSH的安全验证方式

* 基于密码

当通过账号和密码登录远程主机后，说传输的数据都会被加密，但是仍不可避免中间人攻击。
	
* 基于密钥

在本地创建一对密钥（公有密钥：id_rsa.pub、私有密钥：id_rsa）,把共有密钥放在需要访问的服务器上。这样每次客户端请求数据就用私钥加密，服务端拿到加密后的数据，再用服务端有的公钥解密还原真实内容。

### git中SSH的使用

git中使用SSH也是先在本地创建一对密钥，然后把公钥放在服务器上。如粘贴id_rsa.pub的内容至你的github账户中的SSH Keys中，这样就建立了本地、远程认证关系。

当向服务器发送请求时，如git push origin master,推送主分支到远程仓库。会通过你发送过来的共有密钥和服务器上的共有密钥进行比较，如果两个密钥一致则服务器验证通过。这样就避免了中间人攻击。

### 第一次生成ssh key

1. 生成ssh key，使用ssh-keygen命令

   `ssh-keygen`
	
运行上面的命令以后，系统会出现一系列提示，可以一路回车。

2. 查看ssh生成的key文件，应该分别是公钥文件id_rsa.pub和私钥文件id_rsa。

	`cd ~/.ssh`
	
	`ls`
	
3. 复制公钥文件id_rsa.pub的内容并保存到服务器端。

![sshkeys](/public/upload/2014-12-09-sshkeys.png)

### 多个网站的配置

也许你刚刚配好了github的，但是现在你又要使用gitcafe做一个个人博客了，亦或者现在你的team用的却是gitlab做的代码管理，这都意味着你可能需要同时跟多个网站建立起良好的SSH关系了。

当然你可以把上面生成的id_rsa.pub的内容全部copy到上述各个网站的ssh-key管理页面上。但是作为一个有洁癖的程序员一般都鄙视这么干，这感觉就好比多个人共用了一双筷子。

于是我们需要生成多个key并分别针对不同的服务器使用不同的key，how？

1. 生成第二个key

	`ssh-keygen`
	
当系统提示你键入文件名的时候，输入一个不同于默认(id_rsa)的名字，比如我们可以叫id_rsa_gitcafe

2. 把id_rsa_gitcafe.pub内容复制到服务器上保存

3. 配置不同的服务器使用不同的key

	`cd ~/.ssh`
	
在~/.ssh目录下新建一个config文件

	vi config
	
添加如下内容

	# github
	Host github.com
	  HostName github.com
	  PreferredAuthentications publickey
	  IdentityFile ~/.ssh/id_rsa
	
	# gitcafe
	Host gitcafe.com
	  HostName gitcafe.com
	  PreferredAuthentications publickey
	  IdentityFile ~/.ssh/id_rsa_gitcafe
	
4. 测试

	`ssh -T git@gitcafe.com`
	
success 

done


------
参考资料：
http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html
http://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html
http://www.cnblogs.com/BeginMan/p/3544493.html
